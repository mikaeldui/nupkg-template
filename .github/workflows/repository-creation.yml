name: Repository Creation
on: create

jobs:
  create:
    name: 'Create content'
    runs-on: ubuntu-latest
    steps:
    - name: Checkout the newly created repo
      uses: actions/checkout@v2

    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 6.0.x
        
    - name: Get owner name
      id: name
      uses: mikaeldui/action/owner-name@main
        
    - name: Parse project description
      id: description
      uses: mikaeldui/action/repo-templates/parse-description@main
        
    - name: Rename files
      run: |
        rename ProjectName ${{ steps.description.outputs.project-name }} *
        cd ${{ steps.description.outputs.project-name }}        
        rename ProjectName ${{ steps.description.outputs.project-name }} *
        cd ../${{ steps.description.outputs.project-name }}.Tests
        rename ProjectName ${{ steps.description.outputs.project-name }} *
        
    - name: Replace placeholders
      run: |
        grep -RiIl '{{ProjectName}}' | xargs sed -i 's/{{ProjectName}}/${{ steps.description.outputs.project-name }}/g'
        grep -RiIl '{{Prefix}}' | xargs sed -i 's/{{Prefix}}/${{ steps.description.outputs.prefix }}/g'
        grep -RiIl '{{Namespace}}' | xargs sed -i 's/{{Namespace}}/${{ steps.description.outputs.namespace }}/g'
        grep -RiIl '{{Description}}' | xargs sed -i 's/{{Description}}/${{ steps.description.outputs.description }}/g'
        grep -RiIl '{{Tags}}' | xargs sed -i 's/{{Tags}}/${{ steps.description.outputs.ptags }}/g'
        grep -RiIl '{{Package}}' | xargs sed -i 's/{{Package}}/${{ steps.description.outputs.package }}/g'
     
    - name: Fix README.md
      run: echo "Hello"
      
    - name: Add project reference
      if: ${{ steps.description.outputs.package != null }}
      working-directory: ./${{ steps.description.outputs.project-name }}
      run: 'dotnet add package ${{ steps.description.outputs.package }} --version *'
     
    - name: Generate solution
      run: dotnet new sln --name ${{ steps.description.outputs.project-name }}
      
    - name: Add projects to solution
      run: | 
        dotnet sln add ${{ steps.description.outputs.project-name }}
        dotnet sln add ${{ steps.description.outputs.project-name }}.Tests    
        
    - name: Remove this script
      run: rm .github/workflows/repository-creation.yml
      
    - name: ls
      run: ls
    
    - name: Commit files
      uses: swinton/commit@v2.x
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        files: |
          path/to/myfile1
          path/to/myfile2
          path/to/myfile3
        commit-message: Awesome project is ready!
